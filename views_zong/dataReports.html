<!DOCTYPE html>
<html lang="en">
<head>
    <title>智慧社区数据统计</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="智慧社区数据统计">
    <meta name="keyword" content="智慧社区数据统计">
    <link href="css/font-awesome.min.css" rel="stylesheet">
    <link href="css/simple-line-icons.css" rel="stylesheet">
    <link href="css/glyphicons.css" rel="stylesheet">
    <link href="css/glyphicons-filetypes.css" rel="stylesheet">
    <link href="css/glyphicons-social.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <link href="css/total_zsh.css" rel="stylesheet">
    <script src="js/libs/jquery.min.js"></script>
    <script src="js/libs/bootstrap.min.js"></script>
    <script src="js/views/total_zsh.js"></script>
    <script src="./node_modules/angular/angular.min.js"></script>
    <script src="http://cdn.bootcss.com/angular-ui-bootstrap/0.11.2/ui-bootstrap-tpls.js"></script>
    <!-- 线形图与圆环图开始-->
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/highcharts-3d.js"></script>
    <!-- 线形图与圆环图结束-->
    <!-- 地图开始 -->
    <script src="http://code.highcharts.com/highcharts.js"></script>
    <script src="http://code.highcharts.com/maps/modules/map.js"></script>
    <script src="http://code.highcharts.com/maps/modules/data.js"></script>
    <script src="http://code.highcharts.com/maps/modules/drilldown.js"></script>
    <script type="text/javascript" src="http://sandbox.runjs.cn/uploads/rs/228/zroo4bdf/cn-china-by-peng8.js"></script>
    <script type="text/javascript" src="./js/views/totalAngular.js"></script>
    <!-- 地图结束 -->
</head>
<body class="app header-fixed sidebar-fixed aside-menu-fixed aside-menu-hidden" ng-app="project_app" ng-controller="dataReports" ng-cloak>
    <!-- 引入公共header部分 -->
    <div ng-include="'header.html'"></div>
    <div class="app-body">
        <!-- 引入公共sideBar区域开始 -->                 
        <div ng-include="'sideBar.html'"></div>
        <!-- 主要内容区 -->
        <main class="main">
            <div class="container-fluid self_container_padding">
                <div class="animated">
                    <!-- 自定义内容区域 -->
                    <!-- 地图与用户数量统计 -->
                    <div class="row hidden-md-down">
                        <!-- 地图 -->
                        <div class="col-lg-6 col-xs-12 map_col_zsh col_padding_left">
                            <div class="card">
                                <div class="card-header">
                                    <div class="topBar">
                                        地区分区&nbsp;&nbsp;&nbsp;&nbsp;
                                        <span>全国</span>
                                        <span>江西省</span>
                                        <span>九江市</span>
                                    </div>
                                </div>
                                <div class="card-block">
                                    <div id="container_map" style="height:464.5px; min-width: 310px; max-width:800px; margin: 0 auto"></div>
                                </div>
                            </div>
                        </div>
                        <!-- 用户数量统计 -->
                        <div class="col-lg-6 col-xs-12 user_col_zsh col_padding_left">
                            <div class="card">
                                <div class="card-header">
                                    <div class="topBar">
                                        用户数量统计&nbsp;&nbsp;&nbsp;&nbsp;
                                        <span>全国</span>
                                        <span>江西省</span>
                                        <span>九江市</span>
                                        <span>桃花镇</span>
                                    </div>
                                </div>
                                <div class="card-block table_user">
                                    <table class="table table-hover table-outline mb-2 hidden-sm-down table_tj">
                                        <tbody>
                                            <tr>
                                                <td style="width:10%;">1</td>
                                                <td style="width:20%;">街道1</td>
                                                <td style="width:20%;">2000</td>
                                                <td style="width:50%;">
                                                    <div class="progress progress-xs">
                                                        <div class="progress-bar bg-success" role="progressbar" style="width: 90%" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style="width:10%;">2</td>
                                                <td style="width:20%;">街道2</td>
                                                <td style="width:20%;">500</td>
                                                <td style="width:50%;">
                                                    <div class="progress progress-xs">
                                                        <div class="progress-bar bg-success" role="progressbar" style="width: 80%" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style="width:10%;">3</td>
                                                <td style="width:20%;">街道3</td>
                                                <td style="width:20%;">300</td>
                                                <td style="width:50%;">
                                                    <div class="progress progress-xs">
                                                        <div class="progress-bar bg-success" role="progressbar" style="width: 60%" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style="width:10%;">4</td>
                                                <td style="width:20%;">街道4</td>
                                                <td style="width:20%;">100</td>
                                                <td style="width:50%;">
                                                    <div class="progress progress-xs">
                                                        <div class="progress-bar bg-success" role="progressbar" style="width: 10%" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
                                                    </div>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <section  class="pull-right"> 
                                        <pagination  items-per-page="items_per_page" total-items="totalItems" ng-model="currentPage"  ng-change="pageChanged(currentPage)" previous-text="上一页" next-text="下一页"></pagination>
                                    </section>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- 年月日用户量的增长数量 -->
                    <div class="card">
                        <div class="card-block">
                            <div class="row">
                                <div class="col-5 addNum">
                                    <span class="card-title">19.6万</span>
                                    当前用户量
                                </div>
                                <div class="col-7">
                                    <div class="btn-toolbar float-right" role="toolbar" aria-label="Toolbar with button groups">
                                        <div class="btn-group mr-1" data-toggle="buttons" aria-label="First group">
                                            <label class="btn btn-outline-secondary active" aria-pressed="true">
                                                <input type="radio" name="options" id="option1">日
                                            </label>
                                            <label class="btn btn-outline-secondary" aria-pressed="true">
                                                <input type="radio" name="options" id="option2" checked="">月
                                            </label>
                                            <label class="btn btn-outline-secondary" aria-pressed="true">
                                                <input type="radio" name="options" id="option3">年
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="chart-wrapper" id="containerNum" style="height:400px;margin-top:20px;">
                            </div>
                        </div>

                    </div>
                    <!-- 功能模块使用的增长情况 -->
                    <div class="card">
                        <div class="card-block">
                            <div id="containerModule" style="height:400px;"></div>
                        </div>
                    </div>
                    <!-- 自定义内容区结束 -->
                </div>
            </div>
            <!-- /.conainer-fluid -->
        </main>
    </div>
</body>

</html>
<script type="text/javascript">
httpBaseUrl="http://Dev.jgsoft.org";
var loginKey=JSON.parse(window.sessionStorage.getItem("userData"));
var app=angular.module("project_app",['ui.bootstrap']);
/*用户数据统计开始*/
    if(loginKey==null){
        alert("请先登录！");
        window.location.href="./index.html";
    }else{
        app.controller("dataReports",function($scope,$http,$location){
            // 取得用户登录的帐号相关信息
                $scope.userLoginUserData=JSON.parse(window.sessionStorage.getItem("userData"));
                console.log($scope.userLoginUserData);
            });
        /*增长线形图开始*/
            // var categories=['1','2','3','4','5','6','7','8','9','10','11','12','13','14','15','16','17','18','19','20','21','22','23','24','25','26','27','28','29','30'];
            $('#containerNum').highcharts({
                chart: {
                    type: 'areaspline'
                },
                title: {
                    text: ''
                },
                exporting: {
                    enabled:false//去掉右上角的打印及其导出按钮
                },
                legend: {
                    enabled:false,
                    layout: 'vertical',
                    align: 'left',
                    verticalAlign: 'top',
                    x: 150,
                    y: 100,
                    floating: true,
                    borderWidth: 1,
                    backgroundColor: (Highcharts.theme && Highcharts.theme.legendBackgroundColor) || '#FFFFFF'
                },
                xAxis: {
                    // labels: {formatter:function(){return categories[this.value];}},
                    categories:['1','2','3','4','5','6','7','8','9','10','11','12','13','14','15','16','17','18','19','20','21','22','23','24','25','26','27','28','29','30'],             
                    tickInterval:1  
                },
                yAxis: {
                    title: {
                        text: ''
                    }
                },
                tooltip: {
                    shared: false,
                    valueSuffix: ' '
                },
                credits: {
                    enabled: false
                },
                plotOptions: {
                    areaspline: {
                        fillOpacity: 0.5
                    }
                },
                series: [{
                    name: '当前用户',
                    data: [3,4,3,5,4,10,1,2,3,4,3,5,4,10,1,2,3,4,3,5,4,10,1,2,3,4,3,3,4,3]
                }]
            });
        /*增长线形图结束*/
        /*模块使用增长情况开始*/
            Highcharts.chart('containerModule', {
                chart: {
                    type: 'column'
                },
                title: {
                    text: ''
                },
                exporting: {
                    enabled:false//去掉右上角的打印及其导出按钮
                },
                subtitle: {
                    text: ''
                },
                xAxis: {
                    type: 'category',
                    tickWidth:0 //隐藏x轴刻度
                },
                yAxis: {
                    title: {
                        text: ''
                    },
                    labels: {
                        enabled: false //隐藏y轴
                    },
                    gridLineWidth:0 //隐藏背景横线(一条条的横线)
                },
                legend: {
                    enabled: false
                },
                credits: {
                  enabled:false//去掉右下角的highcharts.com
                },
                plotOptions: {
                    series: {
                        borderWidth: 0,
                        dataLabels: {
                            enabled: true,
                            format: '{point.y:.1f}%'
                        }
                    }
                },
                tooltip: {
                    pointFormat: '<span style="color:{point.color}">{point.name}</span>: <b>{point.y:.2f}%</b>'
                },
                series: [{
                    name: '功能模块使用情况',
                    colorByPoint: true,
                    data: [{
                        name: '生活缴费',
                        y: 56.33
                    }, {
                        name: '生活服务',
                        y: 24.03
                    }, {
                        name: '商家促销',
                        y: 10.38
                    }, {
                        name: '楼宇信息',
                        y: 4.77
                    }, {
                        name: '企业信息',
                        y: 0.91
                    }, {
                        name: '楼宇活动',
                        y: 0.2
                    },{
                        name: '受理中心',
                        y: 10
                    },{
                        name: '社区服务',
                        y: 20
                    },{
                        name: '组织管理',
                        y: 30
                    }]
                }],
            });
        /*模块使用增长情况开始*/
        /*地图开始*/
            $(function() {
                Highcharts.setOptions({
                    lang: {
                        drillUpText: "返回"
                    }
                });
                var data = Highcharts.geojson(Highcharts.maps['countries/cn/custom/cn-all-china']),
                    small = $('#container_map').width() < 400;
                // 给城市设置随机数据
                $.each(data, function(i) {
                    this.drilldown = this.properties['drill-key'];
                    this.value = i;
                });

                function getPoint(e) {
                    console.log(e.point.name);
                }

                function getShow(e) {
                    alert(1);
                }
                //初始化地图
                $('#container_map').highcharts('Map', {
                    chart: {
                        spacingBottom: 30,
                        events: {
                            drilldown: function(e) {
                                if (!e.seriesOptions) {
                                    var chart = this;
                                    /*   mapKey = 'countries/china/' + e.point.drilldown + '-all',
                                    fail = setTimeout(function () {
                                          if (!Highcharts.maps[mapKey]) {
                                              chart.showLoading('<i class="icon-frown"></i> 加载失败 ' + e.point.name);
                                              fail = setTimeout(function () {
                                                  chart.hideLoading();
                                              }, 1000);
                                          }
                                      }, 10000);*/
                                    var cname = e.point.properties["cn-name"];
                                    chart.showLoading('<i class="icon-spinner icon-spin icon-3x"></i>');
                                    // 加载城市数据
                                    $.ajax({
                                        type: "GET",
                                        url: "http://data.hcharts.cn/jsonp.php?filename=GeoMap/json/" + e.point.drilldown + ".geo.json",
                                        contentType: "application/json; charset=utf-8",
                                        dataType: 'jsonp',
                                        crossDomain: true,
                                        success: function(json) {
                                            data = Highcharts.geojson(json);
                                            $.each(data, function(i) {
                                                this.value = i;
                                                this.events = {};
                                                this.events.click = getPoint;
                                            });
                                            chart.hideLoading();
                                            chart.addSeriesAsDrilldown(e.point, {
                                                name: e.point.name,
                                                data: data,
                                                events: {
                                                    show: function() {
                                                        alert(1);
                                                    }
                                                },
                                                dataLabels: {
                                                    enabled: true,
                                                    format: '{point.name}'
                                                }
                                            });
                                        },
                                        error: function(XMLHttpRequest, textStatus, errorThrown) {}
                                    });
                                }
                                this.setTitle(null, {
                                    text: cname
                                });
                            },
                            drillup: function() {
                                this.setTitle(null, {
                                    text: '中国'
                                });
                            }
                        }
                    },
                    tooltip: {
                        formatter: function() {
                            var htm = "";
                            if (this.point.drilldown) {
                                htm += this.point.properties["cn-name"];
                            } else {
                                htm += this.point.name;
                            }
                            htm += ":" + this.point.value;
                            return htm;
                        }
                    },
                    credits: {
                        href: "javascript:goHome()",
                        text: "全国共"+"<span class='mapNum'>1254741</span>"+"人"
                    },
                    title: {
                        text: ''
                    },
                    subtitle: {
                        text: '',
                        floating: true,
                        align: 'right',
                        y: 50,
                        style: {
                            fontSize: '16px'
                        }
                    },
                    legend: small ? {} : {
                        // enabled: false,
                        layout: 'vertical',
                        align: 'right',
                        verticalAlign: 'middle'
                    },
                    //tooltip:{
                    //pointFormat:"{point.properties.cn-name}:{point.value}"
                    //},
                    colorAxis: {
                        min: 0,
                        minColor: '#E6E7E8',
                        maxColor: '#005645',
                        labels: {
                            style: {
                                "color": "red",
                                "fontWeight": "bold"
                            }
                        }
                    },
                    mapNavigation: {
                        enabled: true,
                        buttonOptions: {
                            verticalAlign: 'bottom'
                        }
                    },
                    plotOptions: {
                        map: {
                            states: {
                                hover: {
                                    color: '#EEDD66'
                                }
                            }
                        }
                    },
                    series: [{
                        data: data,
                        name: '中国',
                        dataLabels: {
                            enabled: true,
                            format: '{point.properties.cn-name}'
                        }
                    }],
                    exporting: {
                        enabled: false //去掉右上角的打印及其导出按钮
                    },
                    drilldown: {
                        activeDataLabelStyle: {
                            color: '#FFFFFF',
                            textDecoration: 'none',
                            textShadow: '0 0 3px #000000'
                        },
                        drillUpButton: {
                            relativeTo: 'spacingBox',
                            position: {
                                x: 0,
                                y: 60
                            }
                        }
                    }
                });
            });
            var base64EncodeChars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";
            var base64DecodeChars = new Array(-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 62, -1, -1, -1, 63,
                52, 53, 54, 55, 56, 57, 58, 59, 60, 61, -1, -1, -1, -1, -1, -1, -1, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14,
                15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, -1, -1, -1, -1, -1, -1, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40,
                41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, -1, -1, -1, -1, -1);
            function base64decode(str) {
                var c1, c2, c3, c4;
                var i, len, out;
                len = str.length;
                i = 0;
                out = "";
                while (i < len) {
                    /* c1 */
                    do {
                        c1 = base64DecodeChars[str.charCodeAt(i++) & 0xff];
                    } while (i < len && c1 == -1);
                    if (c1 == -1)
                        break;
                    /* c2 */
                    do {
                        c2 = base64DecodeChars[str.charCodeAt(i++) & 0xff];
                    } while (i < len && c2 == -1);
                    if (c2 == -1)
                        break;
                    out += String.fromCharCode((c1 << 2) | ((c2 & 0x30) >> 4));
                    /* c3 */
                    do {
                        c3 = str.charCodeAt(i++) & 0xff;
                        if (c3 == 61)
                            return out;
                        c3 = base64DecodeChars[c3];
                    } while (i < len && c3 == -1);
                    if (c3 == -1)
                        break;
                    out += String.fromCharCode(((c2 & 0XF) << 4) | ((c3 & 0x3C) >> 2));
                    /* c4 */
                    do {
                        c4 = str.charCodeAt(i++) & 0xff;
                        if (c4 == 61)
                            return out;
                        c4 = base64DecodeChars[c4];
                    } while (i < len && c4 == -1);
                    if (c4 == -1)
                        break;
                    out += String.fromCharCode(((c3 & 0x03) << 6) | c4);
                }
                return out;
            }
            // function goHome(){
            //     window.open("http://www.peng8.net/");
            // }
            function getGithub() {
                $.getJSON("https://api.github.com/repos/peng8/GeoMap/contents/json/bei_jing.geo.json", function(data) {
                    console.log(base64decode(data.content));
                });
            };
        /*地图结束*/
};  
/*用户数据统计结束*/ 
</script>